// ollama popup tab
const highlightColor = "rgb(213, 234, 255)"

const template = `
<div id="ollama-tab">
    <button id="ollama-translate">
        <svg t="1709710347033" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2187" width="200" height="200"><path d="M810.666667 938.666667H213.333333a128 128 0 0 1-128-128V213.333333a128 128 0 0 1 128-128h597.333334a128 128 0 0 1 128 128v597.333334a128 128 0 0 1-128 128zM213.333333 170.666667a42.666667 42.666667 0 0 0-42.666666 42.666666v597.333334a42.666667 42.666667 0 0 0 42.666666 42.666666h597.333334a42.666667 42.666667 0 0 0 42.666666-42.666666V213.333333a42.666667 42.666667 0 0 0-42.666666-42.666666z" p-id="2188"></path><path d="M640 660.053333H384a128 128 0 0 1-128-128v-85.333333a128 128 0 0 1 128-128h256a128 128 0 0 1 128 128v85.333333a128 128 0 0 1-128 128z m-256-256a42.666667 42.666667 0 0 0-42.666667 42.666667v85.333333a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667v-85.333333a42.666667 42.666667 0 0 0-42.666667-42.666667z" p-id="2189"></path><path d="M512 788.906667a42.666667 42.666667 0 0 1-42.666667-42.666667v-469.333333a42.666667 42.666667 0 0 1 85.333334 0v469.333333a42.666667 42.666667 0 0 1-42.666667 42.666667z" p-id="2190"></path></svg>
    </button>
    <button id="ollama-summary">
        <svg t="1709710654193" class="icon" viewBox="0 0 1115 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3164" width="200" height="200"><path d="M173.907173 79.932489c-34.565401 0-61.56962 28.084388-61.56962 61.569621V885.738397c0 34.565401 28.084388 61.56962 61.56962 61.56962H950.548523c34.565401 0 61.56962-28.084388 61.56962-61.56962V141.50211c0-34.565401-28.084388-61.56962-61.56962-61.569621H173.907173z m0-62.649789H950.548523c68.050633 0 124.219409 55.088608 124.219409 124.21941V885.738397c0 68.050633-55.088608 124.219409-124.219409 124.219409H173.907173C105.85654 1008.877637 49.687764 953.78903 49.687764 885.738397V141.50211c0-68.050633 56.168776-124.219409 124.219409-124.21941z m708.590717 210.632912c18.362869 0 33.485232 15.122363 33.485232 33.485232 0 18.362869-15.122363 33.485232-33.485232 33.485232H573.56962c-11.881857 0-22.683544-6.481013-29.164557-17.2827-6.481013-10.801688-6.481013-23.763713 0-33.485233 6.481013-10.801688 17.2827-17.2827 29.164557-17.2827h308.92827v1.080169z m-484.99578-51.848101c14.042194-12.962025 35.64557-11.881857 47.527426 2.160337 12.962025 14.042194 11.881857 35.64557-2.160338 47.527426l-92.894514 84.253165c-11.881857 10.801688-31.324895 11.881857-44.28692 1.080169l-61.569621-50.767933c-12.962025-11.881857-15.122363-32.405063-3.240506-46.447257 11.881857-14.042194 31.324895-16.202532 46.447258-6.481013l38.886075 32.405063 71.29114-63.729957z m484.99578 291.645569c18.362869 0 33.485232 15.122363 33.485232 33.485232 0 18.362869-15.122363 33.485232-33.485232 33.485232H573.56962c-18.362869 0-33.485232-15.122363-33.485232-33.485232 0-18.362869 15.122363-33.485232 33.485232-33.485232h308.92827z m-484.99578-50.767932c14.042194-11.881857 34.565401-10.801688 46.447257 3.240506 11.881857 12.962025 11.881857 34.565401-1.080169 46.447257L349.974684 550.886076c-11.881857 10.801688-31.324895 11.881857-44.28692 1.080169l-61.569621-50.767933c-9.721519-7.561181-14.042194-19.443038-11.881856-31.324894 2.160338-11.881857 9.721519-21.603376 21.603375-25.924051 11.881857-4.320675 23.763713-2.160338 33.485233 5.400844l38.886075 32.405063 71.29114-64.810126z m484.99578 290.565401c18.362869 0 33.485232 15.122363 33.485232 33.485232s-15.122363 33.485232-33.485232 33.485232H265.721519c-18.362869 0-33.485232-15.122363-33.485232-33.485232s15.122363-33.485232 33.485232-33.485232h616.776371z m-42.126582-4.320676" fill="#333333" p-id="3165"></path></svg>
    </button>
    <button id="ollama-decorate">
        <svg t="1709710794032" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4181" width="200" height="200"><path d="M1024 102.4c0-23.893333-10.24-47.786667-27.306667-64.853333l-3.413333-3.413334C955.733333-3.413333 897.706667-3.413333 860.16 34.133333L320.853333 532.48c-71.68-17.066667-150.186667 3.413333-208.213333 61.44-75.093333 75.093333-75.093333 160.426667-71.68 208.213333v20.48c0 40.96-23.893333 92.16-30.72 105.813334-6.826667 10.24-6.826667 23.893333-3.413333 34.133333s13.653333 23.893333 27.306666 27.306667c51.2 20.48 102.4 34.133333 153.6 34.133333 88.746667 0 170.666667-34.133333 232.106667-95.573333 51.2-51.2 81.92-116.053333 81.92-177.493334 0-13.653333 0-30.72-3.413333-44.373333L996.693333 167.253333c17.066667-17.066667 27.306667-40.96 27.306667-64.853333M358.4 863.573333c-64.853333 64.853333-153.6 85.333333-249.173333 61.44 10.24-27.306667 20.48-64.853333 20.48-98.986666v-23.893334c0-44.373333-3.413333-95.573333 47.786666-146.773333 54.613333-54.613333 139.946667-54.613333 194.56 0 27.306667 27.306667 40.96 58.026667 40.96 92.16 0 40.96-20.48 81.92-54.613333 116.053333M935.253333 105.813333s-3.413333 0 0 0l-477.866666 512c-6.826667-6.826667-13.653333-17.066667-20.48-23.893333-6.826667-6.826667-17.066667-13.653333-23.893334-20.48l512-477.866667c3.413333-3.413333 6.826667-3.413333 6.826667 0l3.413333 3.413334v6.826666" fill="#2c2c2c" p-id="4182"></path></svg>
    </button>
    <button id="ollama-explain">
        <svg t="1709710893227" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5184" width="200" height="200"><path d="M464 784.352c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48zM512 960C264.96 960 64 759.04 64 512S264.96 64 512 64s448 200.96 448 448-200.96 448-448 448z m0-831.713c-211.584 0-383.713 172.129-383.713 383.713 0 211.552 172.129 383.713 383.713 383.713 211.552 0 383.713-172.16 383.713-383.713 0-211.584-172.161-383.713-383.713-383.713z m0 545.408c-17.665 0-32-14.336-32-31.999v-54.112c0-52.353 39.999-92.352 75.327-127.648 25.887-25.92 52.672-52.672 52.672-74.016 0-53.344-43.072-96.736-95.999-96.736-53.823 0-96 41.536-96 94.56 0 17.664-14.335 31.999-32 31.999s-32-14.336-32-32c0-87.423 71.774-158.559 160-158.559S672 297.28 672 385.92c0 47.904-36.32 84.191-71.424 119.296-27.84 27.776-56.575 56.512-56.575 82.335v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="5185"></path></svg>
    </button>
</div>
`

const styled = ({ display = "none", left = 0, top = 0 }) => `
#ollama-tab {
    align-items: center;
    background-color: black;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    display: ${display};
    justify-content: center;
    left: ${left}px;
    padding: 5px 10px;
    position: fixed;
    top: ${top}px;
    width: 80px;
    z-index: 9999;
  }
`

class OllamaTab extends HTMLElement {
    constructor() {
        super()
        this.render()
    }

    render() {
        this.attachShadow({ mode: "open" })
        const style = document.createElement("style")
        style.textContent = styled({})
        this.shadowRoot.appendChild(style)
        this.shadowRoot.innerHTML += template
    }

    attributeChangedCallback(name, oldValue, newValue) {
        if (name === "markerPosition") {
          this.styleElement.textContent = styled(this.markerPosition);
        }
      }

    static get observedAttributes() {
        return ["markerPosition"];
    }

    get markerPosition() {
        return JSON.parse(this.getAttribute("markerPosition") || "{}");
      }
    
    get styleElement() {
        return this.shadowRoot.querySelector("style");
    }
}

window.customElements.define("ollama-tab", OllamaTab)


